var http=require("http"),nodemailer=require("nodemailer"),fs=require("fs"),url=require("url"),createsmtpTransport=function(a,b){return nodemailer.createTransport("SMTP",{service:"Gmail",auth:{user:a,pass:b}})},port=Number(process.env.PORT||8E3),filename=process.argv[2]?process.argv[2]:"emailLogin.json";if(fs.existsSync(filename))var fileString=fs.readFileSync(filename),fileObject=JSON.parse(fileString);else fileObject={user:process.env.user,pass:process.env.pass,to:process.env.to};
var smtpTransport=createsmtpTransport(fileObject.user,fileObject.pass),server=http.createServer(function(a,b){var c="";"POST"===a.method?(b.writeHead(200,{"Content-Type":"application/json"}),a.on("data",function(b){c+=b}).on("end",function(){var a=JSON.parse(c);a.to=fileObject.to;smtpTransport.sendMail(a,function(a){a?(console.log(a),b.end(JSON.stringify(fileObject))):b.end(JSON.stringify([!0]))})})):(console.log("test!"),b.writeHead(200,{"Content-Type":"text/plain"}),b.end("The email server is running. Please use POST to send a message. "))});
server.listen(port);
